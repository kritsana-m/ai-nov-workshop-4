# Database ER Diagram

This file contains an Entity-Relationship diagram (Mermaid format) representing the database tables and relationships inferred
from the backend code in `internal/models`.

```mermaid
erDiagram
    users {
        uint id PK "autoIncrement"
        string member_code "unique, not null"
        string membership_level
        string name
        string surname
        string phone
        string email
        string registration_date
        int remaining_points
    }

    transfers {
        uint id PK "autoIncrement"
        uint from_user_id FK "not null"
        uint to_user_id FK "not null"
        int amount "not null"
        string status "not null"
        string note
        string idempotency_key "unique, not null"
        datetime created_at
        datetime updated_at
        datetime completed_at
        string fail_reason
    }

    point_ledgers {
        uint id PK "autoIncrement"
        uint user_id FK "not null"
        int change "not null"
        int balance_after "not null"
        string event_type "not null"
        uint transfer_id FK
        string reference
        string metadata
        datetime created_at
    }

    users ||--o{ transfers : "from_user / to_user"
    users ||--o{ point_ledgers : "has"
    transfers ||--o{ point_ledgers : "creates"

    %% Notes:
    %% - Field types are approximated from Go types in `internal/models/models.go`.
    %% - `uint` and `int` map to integer types in the DB; `time.Time` mapped to datetime.
    %% - Constraints such as `uniqueIndex`, `not null`, and `index` are noted in the field comments.
```

## How this map was created

The diagram was generated by inspecting `internal/models/models.go`. The repository uses GORM (SQLite driver) and AutoMigrate to create these tables at runtime (see `internal/store/store.go`).

If you want a PNG/SVG export, render this Mermaid block using any Mermaid renderer (VS Code Mermaid Preview, mermaid.cli, or Mermaid Live Editor).
