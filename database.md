# Database ER Diagram

This file contains an Entity-Relationship diagram (Mermaid format) representing the database tables and relationships inferred
from the backend code in `internal/models`.

```mermaid
erDiagram
    USERS {
        uint ID PK "autoIncrement"
        string MemberCode "unique, not null"
        string MembershipLevel
        string Name
        string Surname
        string Phone
        string Email
        string RegistrationDate
        int RemainingPoints
    }

    TRANSFERS {
        uint ID PK "autoIncrement"
        uint FromUserID FK "not null"
        uint ToUserID FK "not null"
        int Amount "not null"
        string Status "not null"
        string Note
        string IdempotencyKey "unique, not null"
        datetime CreatedAt
        datetime UpdatedAt
        datetime CompletedAt
        string FailReason
    }

    POINT_LEDGERS {
        uint ID PK "autoIncrement"
        uint UserID FK "not null"
        int Change "not null"
        int BalanceAfter "not null"
        string EventType "not null"
        uint TransferID FK
        string Reference
        string Metadata
        datetime CreatedAt
    }

    USERS ||--o{ TRANSFERS : "from (FromUserID)"
    USERS ||--o{ TRANSFERS : "to (ToUserID)"
    USERS ||--o{ POINT_LEDGERS : "has"
    TRANSFERS ||--o{ POINT_LEDGERS : "may_generate (TransferID)"

    %% Notes:
    %% - Field types are approximated from Go types in `internal/models/models.go`.
    %% - `uint` and `int` map to integer types in the DB; `time.Time` mapped to datetime.
    %% - Constraints such as `uniqueIndex`, `not null`, and `index` are noted in the field comments.
```

## How this map was created

The diagram was generated by inspecting `internal/models/models.go`. The repository uses GORM (SQLite driver) and AutoMigrate to create these tables at runtime (see `internal/store/store.go`).

If you want a PNG/SVG export, render this Mermaid block using any Mermaid renderer (VS Code Mermaid Preview, mermaid.cli, or Mermaid Live Editor).
